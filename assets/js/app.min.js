document.addEventListener("DOMContentLoaded",()=>{document.documentElement.classList.remove("is-leaving");const t=document.querySelector("header");if(!t)return;let e=!1;const r=()=>{e||(e=!0,window.requestAnimationFrame(()=>{t.classList.toggle("is-scrolled",window.scrollY>10),e=!1}))};r(),window.addEventListener("scroll",r,{passive:!0})}),document.querySelectorAll("a[href]").forEach(t=>{const e=t.getAttribute("href");!e||e.includes("#")||e.startsWith("http")||e.startsWith("mailto:")||e.startsWith("tel:")||t.addEventListener("click",t=>{t.preventDefault(),document.documentElement.classList.add("is-leaving"),setTimeout(()=>{window.location.href=e},160)})}),(()=>{const t="gptishka_cart_v1",e="selected_cart",r=document.getElementById("pricingGrid");let n=[];const i=document.getElementById("cartList"),a=document.getElementById("cartEmpty"),o=document.getElementById("cartTotal"),c=document.getElementById("cartCheckoutBtn"),s=(document.getElementById("cart"),document.getElementById("headerCart")),l=document.getElementById("headerCartTotal"),d=document.getElementById("headerCartCount"),u=document.getElementById("headerCartPanel"),m=document.getElementById("headerCartPanelList"),p=document.getElementById("headerCartPanelEmpty"),g=document.getElementById("headerCartPanelCount"),h=document.getElementById("headerCartPanelTotal"),f=document.getElementById("headerCartPanelCheckoutBtn"),y=document.querySelector(".header-cart-panel__link"),v=document.getElementById("headerCartPromoInput"),b=document.getElementById("headerCartPromoApply"),S=document.getElementById("headerCartPromoMsg"),I=document.getElementById("cartPromoInput"),w=document.getElementById("cartPromoApply"),k=document.getElementById("cartPromoMsg"),C=document.getElementById("headerCartEmailInput"),A=document.getElementById("cartEmailInput"),_=String(document.documentElement.lang||"").toLowerCase().startsWith("en")||window.location.pathname.startsWith("/en/"),E=_?"en-US":"ru-RU",L=_?"/en/cart.html":"/cart.html",B=_?{promo10:"10% discount",promo5:"5% discount",badgeBest:"Best choice",badgeNew:"New",badgeHit:"Hit",badgeSale:"Sale",badgePopular:"Popular",badgeLimited:"Limited",badgeGift:"Bonus",badgePro:"Pro",pillAutoIssue:"Auto-issue",pillInstant:"Instant",pillWarranty:"Warranty",productsUnavailable:"Products are temporarily unavailable",payNow:"Pay",qtyDec:"Decrease quantity",qtyInc:"Increase quantity",metaAuto:"Automatic",metaSecure:"Secure",metaSupport:"24/7 support",panelCount:t=>`${t} items`,promoApplied:(t,e)=>`${t} applied (-${e})`,promoInvalid:"Promo code not found",promoChecking:"Checking promo code...",promoAccepted:"Promo code accepted. Final amount will be locked at checkout.",remove:"Remove",paymentFallback:"Order payment",cartCheckoutDesc:"Cart checkout",cartSummaryPrefix:"Cart: ",emailPlaceholder:"Email for order details",invalidEmail:"Please enter a valid email",checkoutError:"Failed to start checkout. Please try again.",checkoutProductMissing:"The selected item is outdated in cart. Please re-add it from pricing.",multiCartCheckout:"Checkout is currently available one item at a time. Please pay items separately."}:{promo10:"Ð¡ÐºÐ¸Ð´ÐºÐ° 10%",promo5:"Ð¡ÐºÐ¸Ð´ÐºÐ° 5%",badgeBest:"Ð›ÑƒÑ‡ÑˆÐ¸Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€",badgeNew:"ÐÐ¾Ð²Ð¸Ð½ÐºÐ°",badgeHit:"Ð¥Ð¸Ñ‚",badgeSale:"ÐÐºÑ†Ð¸Ñ",badgePopular:"ÐŸÐ¾Ð¿ÑƒÐ»ÑÑ€Ð½Ð¾",badgeLimited:"ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¾",badgeGift:"Ð‘Ð¾Ð½ÑƒÑ",badgePro:"Pro",pillAutoIssue:"ÐÐ²Ñ‚Ð¾Ð²Ñ‹Ð´Ð°Ñ‡Ð°",pillInstant:"ÐœÐ³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾",pillWarranty:"Ð“Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ",productsUnavailable:"Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹",payNow:"ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ",qtyDec:"Ð£Ð¼ÐµÐ½ÑŒÑˆÐ¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾",qtyInc:"Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾",metaAuto:"ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸",metaSecure:"Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾",metaSupport:"ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° 24/7",panelCount:t=>`${t} Ð¿Ð¾Ð·.`,promoApplied:(t,e)=>`${t} Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð° (-${e})`,promoInvalid:"ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½",promoChecking:"ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´...",promoAccepted:"ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ Ð¿Ñ€Ð¸Ð½ÑÑ‚",remove:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",paymentFallback:"ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð·Ð°ÐºÐ°Ð·Ð°",cartCheckoutDesc:"ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñ‹",cartSummaryPrefix:"ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°: ",emailPlaceholder:"Email Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð°",invalidEmail:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ email",checkoutError:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.",checkoutProductMissing:"Ð¢Ð¾Ð²Ð°Ñ€ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ðµ ÑƒÑÑ‚Ð°Ñ€ÐµÐ». Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÐµÐ³Ð¾ Ð·Ð°Ð½Ð¾Ð²Ð¾ Ð¸Ð· Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð².",multiCartCheckout:"Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð¿Ð¾ Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ñ‚Ð¾Ð²Ð°Ñ€Ñƒ. ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸."},x="gptishka_cart_promo_v1",P="gptishka_cart_promo_ts_v1";let q=null,M="",T="idle",N=0,U="";function D(t){const e=Number.parseInt(String(t||"").replace(/[^\d-]/g,""),10);return Number.isFinite(e)?e:0}function j(t){if("number"==typeof t)return Number.isFinite(t)?t:0;const e=String(t||"").replace(/\s+/g,"").replace(/,/g,".").replace(/[^\d.-]/g,""),r=Number.parseFloat(e);return Number.isFinite(r)?r:0}function F(t){const e=Math.max(0,j(t)),r=Math.abs(e%1)>1e-6;return e.toLocaleString(E,{minimumFractionDigits:r?2:0,maximumFractionDigits:2})}function O(t){return F(t)+" RUB"}function R(t){return String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function H(t="auto"){const e=String(window.location.hash||"").trim();if(!e||"#"===e)return;const r=decodeURIComponent(e.slice(1));if(!r)return;const n=document.getElementById(r);n&&n.scrollIntoView({behavior:t,block:"start"})}function W(){n=Array.from(document.querySelectorAll(".price-card[data-product]"))}function J(t,e){const r=String(t.product||t.id||"product_"+e).trim(),n=String(t.title||"Product").trim(),i=String(t.description||"").trim(),a=String(t.category||"").trim(),o=Array.isArray(t.tags)?t.tags.filter(Boolean):[],c=o.filter(t=>!String(t).startsWith("badge:")),s=a||(c[0]?c[0].toUpperCase():"DIGITAL"),l=c.length?c.slice(0,3).join(" â€¢ "):i.slice(0,90),d=(_?["âš¡ Fast responses","ðŸ§  Help with tasks of any complexity","ðŸŒ Works in multiple languages","ðŸ’¼ Useful for work and business","ðŸ›  Universal tool"]:["âš¡ ÐœÐ³Ð½Ð¾Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹","ðŸ§  ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð² Ð·Ð°Ð´Ð°Ñ‡Ð°Ñ… Ð»ÑŽÐ±Ð¾Ð¹ ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸","ðŸŒ Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÐ·Ñ‹ÐºÐ°Ñ…","ðŸ’¼ ÐŸÐ¾Ð»ÐµÐ·ÐµÐ½ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð±Ð¸Ð·Ð½ÐµÑÐ°","ðŸ›  Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚"]).map(t=>'<div class="sub-top-line">'+R(t)+"</div>").join(""),u=Math.max(0,j(t.price)),m=String(t.currency||"RUB").toUpperCase(),p=function(t,e){const r=String(t||"").toLowerCase(),n=new Set(["best","new","hit","sale","popular","limited","gift","pro"]);if(n.has(r))return r;if(Array.isArray(e)){const t=e.map(t=>String(t||"").toLowerCase()).find(t=>t.startsWith("badge:"));if(t){const e=t.split(":")[1]||"";if(n.has(e))return e}}return""}(t.badge,o),g={best:B.badgeBest,new:B.badgeNew,hit:B.badgeHit,sale:B.badgeSale,popular:B.badgePopular,limited:B.badgeLimited,gift:B.badgeGift,pro:B.badgePro},h=p?'<span class="badge '+R(p)+'">'+R(g[p]||B.badgeBest)+"</span>":"",f=(i?i.split(/\r?\n|[.;]/).map(t=>t.trim()).filter(Boolean):[]).slice(0,5).map(t=>{const e=String(t||"").toLowerCase();return'<li class="'+(e.startsWith("Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ")||e.startsWith("duration")?"feature-line feature-duration":"feature-line")+'">&#10003; '+R(t)+"</li>"}).join("")||"<li>&#10003; "+R(B.metaAuto)+"</li><li>&#10003; "+R(B.metaSecure)+"</li><li>&#10003; "+R(B.metaSupport)+"</li>";return'<div class="price-card'+("best"===p?" featured":"")+'" data-product="'+R(r)+'" data-product-id="'+R(String(t.id||""))+'" data-title="'+R(n)+'" data-sub="'+R(l)+'" data-term="'+R(s)+'" data-price="'+R(u)+'" data-currency="'+R(m)+'">'+h+"<h3>"+R(n)+'</h3><div class="term">'+R(s)+'</div><div class="sub sub-top-list">'+d+'</div><div class="price">'+R(function(t,e){const r=Math.max(0,j(t)),n=String(e||"RUB").toUpperCase(),i="RUB"===n?"RUB":n;return F(r)+" "+i}(u,m))+"</div><ul>"+f+'</ul><div class="price-actions"><button type="button" class="buy-btn pay-now-btn" data-product="'+R(r)+'" data-sub="'+R(l)+'" data-title="'+R(n)+'" data-term="'+R(s)+'" data-price="'+R(u)+'" data-currency="'+R(m)+'">'+R(B.payNow)+'</button></div><div class="meta"><span>&#10003; '+R(B.metaAuto)+"</span><span>&#10003; "+R(B.metaSecure)+"</span><span>&#10003; "+R(B.metaSupport)+"</span></div></div>"}function $(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(t||"").trim())}function G(t){t&&(t.classList.add("is-invalid"),t.focus(),setTimeout(()=>t.classList.remove("is-invalid"),1400))}function Q(){const t=[String(C?C.value:"").trim().toLowerCase(),String(A?A.value:"").trim().toLowerCase(),String(localStorage.getItem("checkout_email")||"").trim().toLowerCase()].filter(Boolean)[0]||"";return $(t)?(localStorage.setItem("checkout_email",t),C&&(C.value=t),A&&(A.value=t),t):(G(C),G(A),alert(B.invalidEmail),"")}async function V(t,e,r){const i=await async function(t){if(!t)return null;if(t.productId)return t;const e=st(n.map(t=>ot(t)).filter(Boolean)),r=e.byProduct.get(ct(t.product))||e.byTitle.get(ct(t.title));if(r){const e={...t,productId:r};return X(K().map(e=>e&&(e.lineId===t.lineId||ct(e.product)===ct(t.product))?{...e,productId:r}:e)),e}try{const e=await fetch("/api/public/products?lang="+(_?"en":"ru"),{cache:"no-store"});if(!e.ok)return t;const r=await e.json(),n=Array.isArray(r?.items)?r.items:[];lt(n);const i=st(n),a=i.byProduct.get(ct(t.product))||i.byTitle.get(ct(t.title));return a?{...t,productId:a}:t}catch(e){return t}}(t);if(!i||!i.productId)throw new Error(B.checkoutProductMissing);ft(void 0,r||"");const a=Q();if(!a)return void alert(B.invalidEmail);const o={email:a,plan_id:i.productId,qty:1,promo_code:r||void 0},c=await fetch("/api/payments/enot/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),s=await c.json().catch(()=>({}));if(!c.ok||!s.pay_url)throw new Error(s?.message||"Checkout init failed");const l=String(s.pay_url);window.location.href=l}function Y(t,e){try{const r=JSON.parse(t);return r&&"object"==typeof r?r:e}catch(t){return e}}function z(t,e=""){if(!t||"object"!=typeof t)return null;const r=String(t.product||e||"").trim();if(!r)return null;return{lineId:String(t.lineId||t.id||"lot_"+Date.now().toString(36)+"_"+Math.random().toString(36).slice(2,10)).trim(),product:r,productId:String(t.productId||"").trim(),title:String(t.title||r).trim(),term:String(t.term||"").trim(),sub:String(t.sub||"").trim(),price:Math.max(0,j(t.price)),currency:String(t.currency||"RUB").trim()||"RUB",qty:1}}function K(){try{const e=Y(localStorage.getItem(t)||"[]",[]);if(Array.isArray(e)){const t=e.map(t=>z(t)).filter(Boolean);return t.length!==e.length&&X(t),t}if(e&&"object"==typeof e){const t=Object.entries(e).map(([t,e])=>z(e,t)).filter(Boolean);return t.length&&X(t),t}return[]}catch(t){return[]}}function X(e){const r=Array.isArray(e)?e.map(t=>z(t)).filter(Boolean):[],n=r.length?[r[r.length-1]]:[];try{localStorage.setItem(t,JSON.stringify(n))}catch(t){}}function Z(t){const e=String(t||"").trim().toUpperCase();try{e?(localStorage.setItem(x,e),localStorage.setItem(P,String(Date.now()))):(localStorage.removeItem(x),localStorage.removeItem(P))}catch(t){}}function tt(){try{const t=Number(localStorage.getItem(P)||0);return Number.isFinite(t)&&t>0?t:0}catch(t){return 0}}function et(){if(!M)return!1;if(!K().some(t=>t&&t.lineId&&t.product&&D(t.qty)>0))return!1;const t=tt();return!!t&&Date.now()-t>=18e5}function rt(){M="",T="idle",N=0,U="",Z(""),v&&(v.value=""),I&&(I.value="")}function nt(t,e){if(!(String(e||"").trim().length>0)||"valid"!==T)return 0;const r=Math.max(0,j(t)),n=Math.max(0,j(N));return Math.min(r,Number(n.toFixed(2)))}async function it(t){const e=String(t||"").trim().toUpperCase();if(!e)return T="idle",N=0,U="",void ht();const r=K().filter(t=>t&&t.lineId&&t.product&&D(t.qty)>0)[0];if(!r||!r.productId)return T="idle",N=0,U="",void ht();const n=Math.max(1,D(r.qty)||1);U=[e,String(r.productId||""),n].join("|"),T="checking",ht();try{const t=await fetch("/api/promo/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,productId:r.productId,quantity:n})}),i=await t.json().catch(()=>({}));t.ok&&i&&i.valid?(T="valid",N=Math.max(0,j(i.discountAmount))):(T="invalid",N=0)}catch(t){T="invalid",N=0}ht()}function at(t,e){t&&(t.classList.remove("is-error","is-success"),"invalid"===e&&t.classList.add("is-error"),"valid"===e&&t.classList.add("is-success"))}function ot(t){if(!t)return null;const e=String(t.getAttribute("data-product")||"").trim();if(!e)return null;const r=t.querySelector("h3"),n=t.querySelector(".term"),i=t.querySelector(".sub"),a=t.querySelector(".price");return{product:e,productId:String(t.getAttribute("data-product-id")||"").trim(),title:String(t.getAttribute("data-title")||(r?r.innerText:"")).replace(/\s+/g," ").trim(),term:String(t.getAttribute("data-term")||(n?n.innerText:"")).replace(/\s+/g," ").trim(),sub:String(t.getAttribute("data-sub")||(i?i.innerText:"")).replace(/\s+/g," ").trim(),price:j(t.getAttribute("data-price")||(a?a.innerText:"")),currency:String(t.getAttribute("data-currency")||"RUB").trim()||"RUB"}}function ct(t){return String(t||"").trim().toLowerCase().replace(/\s+/g," ")}function st(t){const e=new Map,r=new Map;return Array.isArray(t)?(t.forEach(t=>{const n=String(t?.id||"").trim();if(!n)return;const i=ct(t?.product);i&&!e.has(i)&&e.set(i,n);const a=ct(t?.title);a&&!r.has(a)&&r.set(a,n)}),{byProduct:e,byTitle:r}):{byProduct:e,byTitle:r}}function lt(t){const e=st(t),r=K();if(!r.length)return;let n=!1;const i=r.map(t=>{if(!t||t.productId)return t;const r=e.byProduct.get(ct(t.product))||e.byTitle.get(ct(t.title));return r?(n=!0,{...t,productId:r}):t});n&&X(i)}function dt(t){String(t||"").trim();return 1}function ut(t){!function(t,e){const r=String(t||"").trim();if(!r)return;const n=Math.max(0,D(e)),i=K(),a=i.findIndex(t=>t&&t.lineId===r);a<0||(0===n?i.splice(a,1):i[a]={...i[a],qty:1},X(i),ht())}(t,0)}function mt(t){const e=ot(t);if(!e)return;dt(e.product);const r=t.querySelector(".qty-stepper");r&&(r.hidden=!0)}function pt(){n.forEach(mt)}function gt(){u&&(u.classList.remove("open"),u.setAttribute("aria-hidden","true"))}function ht(){et()&&rt();const t=K().filter(t=>t&&t.lineId&&t.product&&D(t.qty)>0),r=t[0],n=r?Math.max(1,D(r.qty)||1):0;(M&&r&&r.productId?[M,String(r.productId||""),n].join("|"):"")!==U&&(M&&r&&r.productId?it(M):(T=M?"invalid":"idle",N=0,U=""));let s=0;t.forEach(t=>{s+=Math.max(0,j(t.price))*Math.max(1,D(t.qty))});const y=nt(s,M),v=Math.max(0,Number((s-y).toFixed(2)));if(l&&(l.textContent=O(v)),d){const e=t.reduce((t,e)=>t+Math.max(1,D(e.qty)),0);d.textContent=String(e)}if(function(t,e){if(!(u&&m&&p&&g&&h&&f))return;const r=t.reduce((t,e)=>t+Math.max(1,D(e.qty)),0),n=nt(e,M),i=Math.max(0,Number((e-n).toFixed(2)));if(g.textContent=B.panelCount(r),h.textContent=O(i),f.disabled=!t.length,f.setAttribute("aria-disabled",t.length?"false":"true"),p.style.display=t.length?"none":"block",!t.length)return m.innerHTML="",S&&(S.textContent="",at(S,"idle")),void(k&&(k.textContent="",at(k,"idle")));const a=M?"checking"===T?B.promoChecking:"valid"===T?B.promoAccepted+(n>0?" (-"+O(n)+")":""):"invalid"===T?B.promoInvalid:"":"";S&&(S.textContent=a,at(S,T)),k&&(k.textContent=a,at(k,T)),m.innerHTML=t.map(t=>{const e=Math.max(0,j(t.price));return'<article class="header-mini-item" data-line-id="'+R(t.lineId)+'"><div class="header-mini-item__top"><div><div class="header-mini-item__title">'+R(t.title||t.product)+'</div><div class="header-mini-item__price">'+R(O(e))+' x 1</div></div><button type="button" class="header-mini-remove-btn">x</button></div></article>'}).join("")}(t,s),o&&(o.textContent=O(v)),c&&(c.setAttribute("aria-disabled",t.length?"false":"true"),c.disabled=!t.length),a&&(a.style.display=t.length?"none":"block"),i)if(t.length){if(k){const t=M?"checking"===T?B.promoChecking:"valid"===T?B.promoAccepted+(y>0?" (-"+O(y)+")":""):"invalid"===T?B.promoInvalid:"":"";k.textContent=t,at(k,T)}i.innerHTML=t.map(t=>{const e=1*Math.max(0,j(t.price));return'<article class="cart-item" data-line-id="'+R(t.lineId)+'"><div class="cart-item__info"><div class="cart-item__name">'+R(t.title||t.product)+'</div><div class="cart-item__meta">'+R((t.term?t.term+" â€¢ ":"")+O(j(t.price))+" x 1 = "+O(e))+'</div></div><div class="cart-item__controls"><button type="button" class="cart-remove-btn">'+R(B.remove)+"</button></div></article>"}).join("")}else{i.innerHTML="",k&&(k.textContent="",at(k,"idle"));try{localStorage.removeItem(e)}catch(t){}}}function ft(t,r){const n=K().filter(t=>t&&t.lineId&&t.product&&D(t.qty)>0);if(!n.length)return;const i=void 0!==t?Math.max(0,j(t)):n.reduce((t,e)=>t+Math.max(0,j(e.price))*Math.max(1,D(e.qty)),0);try{localStorage.setItem(e,JSON.stringify({items:n,total:i,promoCode:r||null,currency:"RUB"}))}catch(t){}}document.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest(".pay-now-btn");if(e){t.preventDefault();const r=ot(e.closest(".price-card"));if(!r)return;Math.max(1,dt(r.product)||1);return function(t){if(!t||!t.product)return;const e=z({lineId:"lot_"+Date.now().toString(36)+"_"+Math.random().toString(36).slice(2,10),product:t.product,productId:t.productId,title:t.title,term:t.term,sub:t.sub,price:t.price,currency:t.currency||"RUB",qty:1});e&&(X([e]),rt(),ht())}(r),ft(void 0,M),void(window.location.href=L)}const r=t.target.closest&&t.target.closest(".header-mini-item");if(r){const e=String(r.getAttribute("data-line-id")||"").trim();if(!e)return;if(!K().find(t=>t&&t.lineId===e))return;if(t.target.closest(".header-mini-remove-btn"))return void ut(e)}if(b&&(t.target===b||t.target.closest("#headerCartPromoApply"))){const t=String(v?v.value:"").trim().toUpperCase();return M=t,Z(M),I&&I.value!==M&&(I.value=M),void it(M)}if(w&&(t.target===w||t.target.closest("#cartPromoApply"))){const t=String(I?I.value:"").trim().toUpperCase();return M=t,Z(M),v&&v.value!==M&&(v.value=M),void it(M)}if(f&&(t.target===f||t.target.closest("#headerCartPanelCheckoutBtn"))){if("true"===f.getAttribute("aria-disabled"))return;const t=K().filter(t=>t&&t.lineId&&t.product&&D(t.qty)>0);if(!t.length)return;if(1!==t.length)return void alert(B.multiCartCheckout);const e=t[0];return void V(e,e.qty,M).catch(()=>{alert(B.checkoutError)})}const n=t.target.closest&&t.target.closest(".cart-item");if(!n)return;const i=String(n.getAttribute("data-line-id")||"").trim();if(!i)return;if(!K().find(t=>t&&t.lineId===i))return;t.target.closest(".cart-remove-btn")&&ut(i)}),c&&c.addEventListener("click",t=>{if("true"===c.getAttribute("aria-disabled"))return void t.preventDefault();const e=K().filter(t=>t&&t.lineId&&t.product&&D(t.qty)>0);if(!e.length)return void t.preventDefault();if(1!==e.length)return t.preventDefault(),void alert(B.multiCartCheckout);const r=e[0];V(r,r.qty,M).catch(()=>{alert(B.checkoutError)})}),M=function(){try{return String(localStorage.getItem(x)||"").trim().toUpperCase()}catch(t){return""}}(),M&&!tt()&&Z(M),et()&&rt(),v&&(v.value=M),I&&(I.value=M),M&&it(M),function(){const t=String(localStorage.getItem("checkout_email")||"").trim().toLowerCase();C&&!String(C.value||"").trim()&&(C.value=t),A&&!String(A.value||"").trim()&&(A.value=t)}(),async function(){if(r)try{const t=await fetch("/api/public/products?lang="+(_?"en":"ru"),{cache:"no-store"});if(!t.ok)throw new Error("Products API not available");const e=await t.json(),n=Array.isArray(e?.items)?e.items:[];if(lt(n),!n.length)return r.innerHTML='<div class="price-card"><h3>'+R(B.productsUnavailable)+"</h3></div>",void W();r.innerHTML=n.map((t,e)=>J(t,e)).join(""),W(),pt(),ht(),H("auto")}catch(t){W(),pt(),ht(),H("auto")}else W()}(),ht(),s&&s.addEventListener("click",t=>{if(t.preventDefault(),t.stopPropagation(),q)return clearTimeout(q),q=null,void(window.location.href=L);q=setTimeout(()=>{if(q=null,!u)return;u.classList.contains("open")?gt():u&&(u.classList.add("open"),u.setAttribute("aria-hidden","false"))},220)}),y&&y.addEventListener("click",t=>{t.preventDefault(),window.location.href=L}),v&&(v.addEventListener("input",()=>{const t=String(v.value||"").trim().toUpperCase();I&&I.value!==t&&(I.value=t)}),v.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),M=String(v.value||"").trim().toUpperCase(),Z(M),I&&I.value!==M&&(I.value=M),it(M))})),I&&(I.addEventListener("input",()=>{const t=String(I.value||"").trim().toUpperCase();v&&v.value!==t&&(v.value=t)}),I.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),M=String(I.value||"").trim().toUpperCase(),Z(M),v&&v.value!==M&&(v.value=M),it(M))})),[C,A].forEach(t=>{t&&(String(t.getAttribute("placeholder")||"").trim()||t.setAttribute("placeholder",B.emailPlaceholder),t.addEventListener("input",()=>{const e=String(t.value||"").trim().toLowerCase();$(e)&&(localStorage.setItem("checkout_email",e),C&&C!==t&&(C.value=e),A&&A!==t&&(A.value=e))}))}),document.addEventListener("click",t=>{u&&s&&(u.contains(t.target)||s.contains(t.target)||gt())}),document.addEventListener("keydown",t=>{"Escape"===t.key&&gt()}),window.addEventListener("gptishka:cart-cleared",()=>{rt(),ht(),pt()}),window.setInterval(()=>{et()&&(rt(),ht())},6e4),window.addEventListener("hashchange",()=>{H("smooth")}),window.gptishkaCart={getQty:function(t){const e=String(t||"").trim();return e?K().reduce((t,r)=>r&&r.product===e?t+Math.max(1,D(r.qty)):t,0):0},getCardQty:dt,getCardItem:ot,persistCartSelection:ft}})(),(()=>{const t="gptishka_reviews_cache_v1",e="gptishka_reviews_cache_ts_v1";function r(){(function(){try{const r=localStorage.getItem(t),n=Number(localStorage.getItem(e)||0),i=JSON.parse(r||"[]"),a=Array.isArray(i)&&i.length>0;return{hasItems:a,isFresh:a&&Date.now()-n<108e5}}catch(t){return{hasItems:!1,isFresh:!1}}})().isFresh||fetch("/api/reviews/telegram?limit=20",{headers:{Accept:"application/json"},cache:"no-store"}).then(t=>t.ok?t.json():Promise.reject(new Error("reviews api failed"))).then(r=>{const n=Array.isArray(r?.items)?r.items:[];n.length&&function(r){try{localStorage.setItem(t,JSON.stringify(r)),localStorage.setItem(e,String(Date.now()))}catch(t){}}(n)}).catch(()=>{})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r()})(),document.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest("a.buy-btn");if(e)try{const t=new URL(e.getAttribute("href"),window.location.href),r=e.getAttribute("data-product")||t.searchParams.get("product")||e.getAttribute("data-plan")||t.searchParams.get("plan"),n={product:r,title:e.getAttribute("data-title")||null,sub:e.getAttribute("data-sub")||null,term:e.getAttribute("data-term")||null,price:e.getAttribute("data-price")||null,currency:e.getAttribute("data-currency")||null,qty:1,total_price:null},i=e.closest&&e.closest(".price-card");if(i){if(!n.title){const t=i.querySelector("h3");t&&(n.title=(t.innerText||"").replace(/\s+/g," ").trim())}if(!n.term){const t=i.querySelector(".term");t&&(n.term=(t.innerText||"").replace(/\s+/g," ").trim())}if(!n.sub){const t=i.querySelector(".sub");t&&(n.sub=(t.innerText||"").replace(/\s+/g," ").trim())}if(!n.price){const t=i.querySelector(".price");t&&(n.price=(t.innerText||"").replace(/[^\d.,-]/g,""))}if(n.currency||(n.currency="RUB"),window.gptishkaCart&&"function"==typeof window.gptishkaCart.getCardQty){const t=window.gptishkaCart.getCardItem(i);if(t&&t.product){const e=window.gptishkaCart.getCardQty(t.product);n.qty=e>0?e:1}}}const a=toAmount(n.price);Number.isFinite(a)&&a>0&&(n.total_price=String(Number((a*n.qty).toFixed(2)))),r&&localStorage.setItem("selected_product",JSON.stringify(n))}catch(t){}},!0),(()=>{const t="gptishka_session_id";let e=null,r=null,n=null,i=!1;function a(t){if(!e)return;const r=Array.isArray(t)?t.filter(Boolean):[],n='<span class="site-ticker__sep">â€¢</span>',i=(r.length?r:["No recent subscriptions yet"]).map(t=>'<span class="site-ticker__item">ðŸ”¥ '+(String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")+" subscribed</span>")).join(n),a=new Array(4).fill(i).join(n);e.innerHTML='<div class="site-ticker__loop">'+a+'</div><div class="site-ticker__loop" aria-hidden="true">'+a+"</div>"}function o(t){const e=Number(t||0);return Number.isFinite(e)?e.toLocaleString():"0"}async function c(){try{const t=await fetch("/api/stats",{cache:"no-store"});if(!t.ok)return;const e=await t.json();r&&(r.textContent=o(e.sales)),n&&(n.textContent=o(e.online)),a(e.lastBuyers)}catch(t){}}async function s(t){try{await fetch("/api/heartbeat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t,path:window.location.pathname}),keepalive:!0})}catch(t){}}function l(){if(i)return;i=!0,function(){if(document.getElementById("siteTicker"))return;const t=document.querySelector("header");if(!t)return;const i=document.createElement("div");i.id="siteTicker",i.className="site-ticker",i.setAttribute("role","status"),i.setAttribute("aria-live","polite"),i.innerHTML=['<div class="site-ticker__marquee">','  <div class="site-ticker__track" id="siteTickerTrack"></div>',"</div>",'<div class="site-ticker__stats">','  <span class="site-ticker__stat"><span class="site-ticker__stat-label">Sales:</span> <strong id="siteTickerSales">0</strong></span>','  <span class="site-ticker__dot"></span>','  <span class="site-ticker__stat"><span class="site-ticker__stat-label">Online:</span> <strong id="siteTickerOnline">0</strong></span>',"</div>"].join(""),t.insertBefore(i,t.firstChild),e=document.getElementById("siteTickerTrack"),r=document.getElementById("siteTickerSales"),n=document.getElementById("siteTickerOnline")}(),a([]);const o=function(){try{const e=localStorage.getItem(t);if(e)return e;const r="s_"+Date.now().toString(36)+"_"+Math.random().toString(36).slice(2,10);return localStorage.setItem(t,r),r}catch(t){return"s_"+Date.now().toString(36)}}();s(o),c(),window.setInterval(()=>{s(o)},2e4),window.setInterval(()=>{c()},15e3)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",l):l()})();