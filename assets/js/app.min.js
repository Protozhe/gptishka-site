document.addEventListener("DOMContentLoaded",()=>{document.documentElement.classList.remove("is-leaving");const t=document.querySelector("header");if(!t)return;let e=!1;const r=()=>{e||(e=!0,window.requestAnimationFrame(()=>{t.classList.toggle("is-scrolled",window.scrollY>10),e=!1}))};r(),window.addEventListener("scroll",r,{passive:!0})}),document.querySelectorAll("a[href]").forEach(t=>{const e=t.getAttribute("href");!e||e.includes("#")||e.startsWith("http")||e.startsWith("mailto:")||e.startsWith("tel:")||t.addEventListener("click",t=>{t.preventDefault(),document.documentElement.classList.add("is-leaving"),setTimeout(()=>{window.location.href=e},160)})}),(()=>{const t="gptishka_cart_v1",e="selected_cart",r=document.getElementById("pricingGrid");let i=[];const n=document.getElementById("cartList"),a=document.getElementById("cartEmpty"),o=document.getElementById("cartTotal"),c=document.getElementById("cartCheckoutBtn"),l=(document.getElementById("cart"),document.getElementById("headerCart")),s=document.getElementById("headerCartTotal"),d=document.getElementById("headerCartCount"),u=document.getElementById("headerCartPanel"),m=document.getElementById("headerCartPanelList"),p=document.getElementById("headerCartPanelEmpty"),g=document.getElementById("headerCartPanelCount"),h=document.getElementById("headerCartPanelTotal"),f=document.getElementById("headerCartPanelCheckoutBtn"),y=document.querySelector(".header-cart-panel__link"),v=document.getElementById("headerCartPromoInput"),b=document.getElementById("headerCartPromoApply"),S=document.getElementById("headerCartPromoMsg"),I=document.getElementById("cartPromoInput"),w=document.getElementById("cartPromoApply"),k=document.getElementById("cartPromoMsg"),C=document.getElementById("headerCartEmailInput"),A=document.getElementById("cartEmailInput"),E=String(document.documentElement.lang||"").toLowerCase().startsWith("en")||window.location.pathname.startsWith("/en/"),_=E?"en-US":"ru-RU",B=E?"/en/cart.html":"/cart.html",L=E?{promo10:"10% discount",promo5:"5% discount",badgeBest:"Best choice",badgeNew:"New",badgeHit:"Hit",badgeSale:"Sale",badgePopular:"Popular",badgeLimited:"Limited",badgeGift:"Bonus",badgePro:"Pro",pillAutoIssue:"Auto-issue",pillInstant:"Instant",pillWarranty:"Warranty",productsUnavailable:"Products are temporarily unavailable",payNow:"Pay",qtyDec:"Decrease quantity",qtyInc:"Increase quantity",metaAuto:"Automatic",metaSecure:"Secure",metaSupport:"24/7 support",panelCount:t=>`${t} items`,promoApplied:(t,e)=>`${t} applied (-${e})`,promoInvalid:"Promo code not found",promoChecking:"Checking promo code...",promoAccepted:"Promo code accepted. Final amount will be locked at checkout.",remove:"Remove",paymentFallback:"Order payment",cartCheckoutDesc:"Cart checkout",cartSummaryPrefix:"Cart: ",emailPlaceholder:"Email for order details",invalidEmail:"Please enter a valid email",checkoutError:"Failed to start checkout. Please try again.",checkoutProductMissing:"The selected item is outdated in cart. Please re-add it from pricing.",multiCartCheckout:"Checkout is currently available one item at a time. Please pay items separately."}:{promo10:"Ð¡ÐºÐ¸Ð´ÐºÐ° 10%",promo5:"Ð¡ÐºÐ¸Ð´ÐºÐ° 5%",badgeBest:"Ð›ÑƒÑ‡ÑˆÐ¸Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€",badgeNew:"ÐÐ¾Ð²Ð¸Ð½ÐºÐ°",badgeHit:"Ð¥Ð¸Ñ‚",badgeSale:"ÐÐºÑ†Ð¸Ñ",badgePopular:"ÐŸÐ¾Ð¿ÑƒÐ»ÑÑ€Ð½Ð¾",badgeLimited:"ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¾",badgeGift:"Ð‘Ð¾Ð½ÑƒÑ",badgePro:"Pro",pillAutoIssue:"ÐÐ²Ñ‚Ð¾Ð²Ñ‹Ð´Ð°Ñ‡Ð°",pillInstant:"ÐœÐ³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾",pillWarranty:"Ð“Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ",productsUnavailable:"Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹",payNow:"ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ",qtyDec:"Ð£Ð¼ÐµÐ½ÑŒÑˆÐ¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾",qtyInc:"Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾",metaAuto:"ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸",metaSecure:"Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾",metaSupport:"ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° 24/7",panelCount:t=>`${t} Ð¿Ð¾Ð·.`,promoApplied:(t,e)=>`${t} Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð° (-${e})`,promoInvalid:"ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½",promoChecking:"ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´...",promoAccepted:"ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ Ð¿Ñ€Ð¸Ð½ÑÑ‚",remove:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",paymentFallback:"ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð·Ð°ÐºÐ°Ð·Ð°",cartCheckoutDesc:"ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñ‹",cartSummaryPrefix:"ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°: ",emailPlaceholder:"Email Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð°",invalidEmail:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ email",checkoutError:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.",checkoutProductMissing:"Ð¢Ð¾Ð²Ð°Ñ€ Ð² ÐºÐ¾Ñ€Ð·Ð¸Ð½Ðµ ÑƒÑÑ‚Ð°Ñ€ÐµÐ». Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÐµÐ³Ð¾ Ð·Ð°Ð½Ð¾Ð²Ð¾ Ð¸Ð· Ñ‚Ð°Ñ€Ð¸Ñ„Ð¾Ð².",multiCartCheckout:"Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð¿Ð¾ Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ñ‚Ð¾Ð²Ð°Ñ€Ñƒ. ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸."},x="gptishka_cart_promo_v1";let P=null,q="",T="idle",M=0,U="";function N(t){const e=Number.parseInt(String(t||"").replace(/[^\d-]/g,""),10);return Number.isFinite(e)?e:0}function j(t){if("number"==typeof t)return Number.isFinite(t)?t:0;const e=String(t||"").replace(/\s+/g,"").replace(/,/g,".").replace(/[^\d.-]/g,""),r=Number.parseFloat(e);return Number.isFinite(r)?r:0}function D(t){const e=Math.max(0,j(t)),r=Math.abs(e%1)>1e-6;return e.toLocaleString(_,{minimumFractionDigits:r?2:0,maximumFractionDigits:2})}function F(t){return D(t)+" RUB"}function O(t){return String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function R(t="auto"){const e=String(window.location.hash||"").trim();if(!e||"#"===e)return;const r=decodeURIComponent(e.slice(1));if(!r)return;const i=document.getElementById(r);i&&i.scrollIntoView({behavior:t,block:"start"})}function H(){i=Array.from(document.querySelectorAll(".price-card[data-product]"))}function W(t,e){const r=String(t.product||t.id||"product_"+e).trim(),i=String(t.title||"Product").trim(),n=String(t.description||"").trim(),a=String(t.category||"").trim(),o=Array.isArray(t.tags)?t.tags.filter(Boolean):[],c=o.filter(t=>!String(t).startsWith("badge:")),l=a||(c[0]?c[0].toUpperCase():"DIGITAL"),s=c.length?c.slice(0,3).join(" â€¢ "):n.slice(0,90),d=(E?["âš¡ Fast responses","ðŸ§  Help with tasks of any complexity","ðŸŒ Works in multiple languages","ðŸ’¼ Useful for work and business","ðŸ›  Universal tool"]:["âš¡ ÐœÐ³Ð½Ð¾Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹","ðŸ§  ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð² Ð·Ð°Ð´Ð°Ñ‡Ð°Ñ… Ð»ÑŽÐ±Ð¾Ð¹ ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸","ðŸŒ Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÐ·Ñ‹ÐºÐ°Ñ…","ðŸ’¼ ÐŸÐ¾Ð»ÐµÐ·ÐµÐ½ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð±Ð¸Ð·Ð½ÐµÑÐ°","ðŸ›  Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚"]).map(t=>'<div class="sub-top-line">'+O(t)+"</div>").join(""),u=Math.max(0,j(t.price)),m=String(t.currency||"RUB").toUpperCase(),p=function(t,e){const r=String(t||"").toLowerCase(),i=new Set(["best","new","hit","sale","popular","limited","gift","pro"]);if(i.has(r))return r;if(Array.isArray(e)){const t=e.map(t=>String(t||"").toLowerCase()).find(t=>t.startsWith("badge:"));if(t){const e=t.split(":")[1]||"";if(i.has(e))return e}}return""}(t.badge,o),g={best:L.badgeBest,new:L.badgeNew,hit:L.badgeHit,sale:L.badgeSale,popular:L.badgePopular,limited:L.badgeLimited,gift:L.badgeGift,pro:L.badgePro},h=p?'<span class="badge '+O(p)+'">'+O(g[p]||L.badgeBest)+"</span>":"",f=(n?n.split(/\r?\n|[.;]/).map(t=>t.trim()).filter(Boolean):[]).slice(0,5).map(t=>{const e=String(t||"").toLowerCase();return'<li class="'+(e.startsWith("Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ")||e.startsWith("duration")?"feature-line feature-duration":"feature-line")+'">&#10003; '+O(t)+"</li>"}).join("")||"<li>&#10003; "+O(L.metaAuto)+"</li><li>&#10003; "+O(L.metaSecure)+"</li><li>&#10003; "+O(L.metaSupport)+"</li>";return'<div class="price-card'+("best"===p?" featured":"")+'" data-product="'+O(r)+'" data-product-id="'+O(String(t.id||""))+'" data-title="'+O(i)+'" data-sub="'+O(s)+'" data-term="'+O(l)+'" data-price="'+O(u)+'" data-currency="'+O(m)+'">'+h+"<h3>"+O(i)+'</h3><div class="term">'+O(l)+'</div><div class="sub sub-top-list">'+d+'</div><div class="price">'+O(function(t,e){const r=Math.max(0,j(t)),i=String(e||"RUB").toUpperCase(),n="RUB"===i?"RUB":i;return D(r)+" "+n}(u,m))+"</div><ul>"+f+'</ul><div class="price-actions"><button type="button" class="buy-btn pay-now-btn" data-product="'+O(r)+'" data-sub="'+O(s)+'" data-title="'+O(i)+'" data-term="'+O(l)+'" data-price="'+O(u)+'" data-currency="'+O(m)+'">'+O(L.payNow)+'</button></div><div class="meta"><span>&#10003; '+O(L.metaAuto)+"</span><span>&#10003; "+O(L.metaSecure)+"</span><span>&#10003; "+O(L.metaSupport)+"</span></div></div>"}function J(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(t||"").trim())}function $(t){t&&(t.classList.add("is-invalid"),t.focus(),setTimeout(()=>t.classList.remove("is-invalid"),1400))}function G(){const t=[String(C?C.value:"").trim().toLowerCase(),String(A?A.value:"").trim().toLowerCase(),String(localStorage.getItem("checkout_email")||"").trim().toLowerCase()].filter(Boolean)[0]||"";return J(t)?(localStorage.setItem("checkout_email",t),C&&(C.value=t),A&&(A.value=t),t):($(C),$(A),alert(L.invalidEmail),"")}async function Q(t,e,r){const n=await async function(t){if(!t)return null;if(t.productId)return t;const e=nt(i.map(t=>rt(t)).filter(Boolean)),r=e.byProduct.get(it(t.product))||e.byTitle.get(it(t.title));if(r){const e={...t,productId:r};return K(z().map(e=>e&&(e.lineId===t.lineId||it(e.product)===it(t.product))?{...e,productId:r}:e)),e}try{const e=await fetch("/api/public/products?lang="+(E?"en":"ru"),{cache:"no-store"});if(!e.ok)return t;const r=await e.json(),i=Array.isArray(r?.items)?r.items:[];at(i);const n=nt(i),a=n.byProduct.get(it(t.product))||n.byTitle.get(it(t.title));return a?{...t,productId:a}:t}catch(e){return t}}(t);if(!n||!n.productId)throw new Error(L.checkoutProductMissing);mt(void 0,r||"");const a=G();if(!a)return void alert(L.invalidEmail);const o={email:a,plan_id:n.productId,qty:1,promo_code:r||void 0},c=await fetch("/api/payments/enot/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),l=await c.json().catch(()=>({}));if(!c.ok||!l.pay_url)throw new Error(l?.message||"Checkout init failed");const s=String(l.pay_url);window.location.href=s}function V(t,e){try{const r=JSON.parse(t);return r&&"object"==typeof r?r:e}catch(t){return e}}function Y(t,e=""){if(!t||"object"!=typeof t)return null;const r=String(t.product||e||"").trim();if(!r)return null;return{lineId:String(t.lineId||t.id||"lot_"+Date.now().toString(36)+"_"+Math.random().toString(36).slice(2,10)).trim(),product:r,productId:String(t.productId||"").trim(),title:String(t.title||r).trim(),term:String(t.term||"").trim(),sub:String(t.sub||"").trim(),price:Math.max(0,j(t.price)),currency:String(t.currency||"RUB").trim()||"RUB",qty:1}}function z(){try{const e=V(localStorage.getItem(t)||"[]",[]);if(Array.isArray(e)){const t=e.map(t=>Y(t)).filter(Boolean);return t.length!==e.length&&K(t),t}if(e&&"object"==typeof e){const t=Object.entries(e).map(([t,e])=>Y(e,t)).filter(Boolean);return t.length&&K(t),t}return[]}catch(t){return[]}}function K(e){const r=Array.isArray(e)?e.map(t=>Y(t)).filter(Boolean):[];try{localStorage.setItem(t,JSON.stringify(r))}catch(t){}}function X(t){try{t?localStorage.setItem(x,t):localStorage.removeItem(x)}catch(t){}}function Z(t,e){if(!(String(e||"").trim().length>0)||"valid"!==T)return 0;const r=Math.max(0,j(t)),i=Math.max(0,j(M));return Math.min(r,Number(i.toFixed(2)))}async function tt(t){const e=String(t||"").trim().toUpperCase();if(!e)return T="idle",M=0,U="",void ut();const r=z().filter(t=>t&&t.lineId&&t.product&&N(t.qty)>0)[0];if(!r||!r.productId)return T="idle",M=0,U="",void ut();const i=Math.max(1,N(r.qty)||1);U=[e,String(r.productId||""),i].join("|"),T="checking",ut();try{const t=await fetch("/api/promo/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,productId:r.productId,quantity:i})}),n=await t.json().catch(()=>({}));t.ok&&n&&n.valid?(T="valid",M=Math.max(0,j(n.discountAmount))):(T="invalid",M=0)}catch(t){T="invalid",M=0}ut()}function et(t,e){t&&(t.classList.remove("is-error","is-success"),"invalid"===e&&t.classList.add("is-error"),"valid"===e&&t.classList.add("is-success"))}function rt(t){if(!t)return null;const e=String(t.getAttribute("data-product")||"").trim();if(!e)return null;const r=t.querySelector("h3"),i=t.querySelector(".term"),n=t.querySelector(".sub"),a=t.querySelector(".price");return{product:e,productId:String(t.getAttribute("data-product-id")||"").trim(),title:String(t.getAttribute("data-title")||(r?r.innerText:"")).replace(/\s+/g," ").trim(),term:String(t.getAttribute("data-term")||(i?i.innerText:"")).replace(/\s+/g," ").trim(),sub:String(t.getAttribute("data-sub")||(n?n.innerText:"")).replace(/\s+/g," ").trim(),price:j(t.getAttribute("data-price")||(a?a.innerText:"")),currency:String(t.getAttribute("data-currency")||"RUB").trim()||"RUB"}}function it(t){return String(t||"").trim().toLowerCase().replace(/\s+/g," ")}function nt(t){const e=new Map,r=new Map;return Array.isArray(t)?(t.forEach(t=>{const i=String(t?.id||"").trim();if(!i)return;const n=it(t?.product);n&&!e.has(n)&&e.set(n,i);const a=it(t?.title);a&&!r.has(a)&&r.set(a,i)}),{byProduct:e,byTitle:r}):{byProduct:e,byTitle:r}}function at(t){const e=nt(t),r=z();if(!r.length)return;let i=!1;const n=r.map(t=>{if(!t||t.productId)return t;const r=e.byProduct.get(it(t.product))||e.byTitle.get(it(t.title));return r?(i=!0,{...t,productId:r}):t});i&&K(n)}function ot(t){String(t||"").trim();return 1}function ct(t){!function(t,e){const r=String(t||"").trim();if(!r)return;const i=Math.max(0,N(e)),n=z(),a=n.findIndex(t=>t&&t.lineId===r);a<0||(0===i?n.splice(a,1):n[a]={...n[a],qty:1},K(n),ut())}(t,0)}function lt(t){const e=rt(t);if(!e)return;ot(e.product);const r=t.querySelector(".qty-stepper");r&&(r.hidden=!0)}function st(){i.forEach(lt)}function dt(){u&&(u.classList.remove("open"),u.setAttribute("aria-hidden","true"))}function ut(){const t=z().filter(t=>t&&t.lineId&&t.product&&N(t.qty)>0),r=t[0],i=r?Math.max(1,N(r.qty)||1):0;(q&&r&&r.productId?[q,String(r.productId||""),i].join("|"):"")!==U&&(q&&r&&r.productId?tt(q):(T=q?"invalid":"idle",M=0,U=""));let l=0;t.forEach(t=>{l+=Math.max(0,j(t.price))*Math.max(1,N(t.qty))});const y=Z(l,q),v=Math.max(0,Number((l-y).toFixed(2)));if(s&&(s.textContent=F(v)),d){const e=t.reduce((t,e)=>t+Math.max(1,N(e.qty)),0);d.textContent=String(e)}if(function(t,e){if(!(u&&m&&p&&g&&h&&f))return;const r=t.reduce((t,e)=>t+Math.max(1,N(e.qty)),0),i=Z(e,q),n=Math.max(0,Number((e-i).toFixed(2)));if(g.textContent=L.panelCount(r),h.textContent=F(n),f.disabled=!t.length,f.setAttribute("aria-disabled",t.length?"false":"true"),p.style.display=t.length?"none":"block",!t.length)return m.innerHTML="",S&&(S.textContent="",et(S,"idle")),void(k&&(k.textContent="",et(k,"idle")));const a=q?"checking"===T?L.promoChecking:"valid"===T?L.promoAccepted+(i>0?" (-"+F(i)+")":""):"invalid"===T?L.promoInvalid:"":"";S&&(S.textContent=a,et(S,T)),k&&(k.textContent=a,et(k,T)),m.innerHTML=t.map(t=>{const e=Math.max(0,j(t.price));return'<article class="header-mini-item" data-line-id="'+O(t.lineId)+'"><div class="header-mini-item__top"><div><div class="header-mini-item__title">'+O(t.title||t.product)+'</div><div class="header-mini-item__price">'+O(F(e))+' x 1</div></div><button type="button" class="header-mini-remove-btn">x</button></div></article>'}).join("")}(t,l),o&&(o.textContent=F(v)),c&&(c.setAttribute("aria-disabled",t.length?"false":"true"),c.disabled=!t.length),a&&(a.style.display=t.length?"none":"block"),n)if(t.length){if(k){const t=q?"checking"===T?L.promoChecking:"valid"===T?L.promoAccepted+(y>0?" (-"+F(y)+")":""):"invalid"===T?L.promoInvalid:"":"";k.textContent=t,et(k,T)}n.innerHTML=t.map(t=>{const e=1*Math.max(0,j(t.price));return'<article class="cart-item" data-line-id="'+O(t.lineId)+'"><div class="cart-item__info"><div class="cart-item__name">'+O(t.title||t.product)+'</div><div class="cart-item__meta">'+O((t.term?t.term+" â€¢ ":"")+F(j(t.price))+" x 1 = "+F(e))+'</div></div><div class="cart-item__controls"><button type="button" class="cart-remove-btn">'+O(L.remove)+"</button></div></article>"}).join("")}else{n.innerHTML="",k&&(k.textContent="",et(k,"idle"));try{localStorage.removeItem(e)}catch(t){}}}function mt(t,r){const i=z().filter(t=>t&&t.lineId&&t.product&&N(t.qty)>0);if(!i.length)return;const n=void 0!==t?Math.max(0,j(t)):i.reduce((t,e)=>t+Math.max(0,j(e.price))*Math.max(1,N(e.qty)),0);try{localStorage.setItem(e,JSON.stringify({items:i,total:n,promoCode:r||null,currency:"RUB"}))}catch(t){}}document.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest(".pay-now-btn");if(e){t.preventDefault();const r=rt(e.closest(".price-card"));if(!r)return;Math.max(1,ot(r.product)||1);return function(t){if(!t||!t.product)return;const e=z();e.push(Y({lineId:"lot_"+Date.now().toString(36)+"_"+Math.random().toString(36).slice(2,10),product:t.product,productId:t.productId,title:t.title,term:t.term,sub:t.sub,price:t.price,currency:t.currency||"RUB",qty:1})),K(e),ut()}(r),mt(void 0,q),void(window.location.href=B)}const r=t.target.closest&&t.target.closest(".header-mini-item");if(r){const e=String(r.getAttribute("data-line-id")||"").trim();if(!e)return;if(!z().find(t=>t&&t.lineId===e))return;if(t.target.closest(".header-mini-remove-btn"))return void ct(e)}if(b&&(t.target===b||t.target.closest("#headerCartPromoApply"))){const t=String(v?v.value:"").trim().toUpperCase();return q=t,X(q),I&&I.value!==q&&(I.value=q),void tt(q)}if(w&&(t.target===w||t.target.closest("#cartPromoApply"))){const t=String(I?I.value:"").trim().toUpperCase();return q=t,X(q),v&&v.value!==q&&(v.value=q),void tt(q)}if(f&&(t.target===f||t.target.closest("#headerCartPanelCheckoutBtn"))){if("true"===f.getAttribute("aria-disabled"))return;const t=z().filter(t=>t&&t.lineId&&t.product&&N(t.qty)>0);if(!t.length)return;if(1!==t.length)return void alert(L.multiCartCheckout);const e=t[0];return void Q(e,e.qty,q).catch(()=>{alert(L.checkoutError)})}const i=t.target.closest&&t.target.closest(".cart-item");if(!i)return;const n=String(i.getAttribute("data-line-id")||"").trim();if(!n)return;if(!z().find(t=>t&&t.lineId===n))return;t.target.closest(".cart-remove-btn")&&ct(n)}),c&&c.addEventListener("click",t=>{if("true"===c.getAttribute("aria-disabled"))return void t.preventDefault();const e=z().filter(t=>t&&t.lineId&&t.product&&N(t.qty)>0);if(!e.length)return void t.preventDefault();if(1!==e.length)return t.preventDefault(),void alert(L.multiCartCheckout);const r=e[0];Q(r,r.qty,q).catch(()=>{alert(L.checkoutError)})}),q=function(){try{return String(localStorage.getItem(x)||"").trim().toUpperCase()}catch(t){return""}}(),v&&(v.value=q),I&&(I.value=q),q&&tt(q),function(){const t=String(localStorage.getItem("checkout_email")||"").trim().toLowerCase();C&&!String(C.value||"").trim()&&(C.value=t),A&&!String(A.value||"").trim()&&(A.value=t)}(),async function(){if(r)try{const t=await fetch("/api/public/products?lang="+(E?"en":"ru"),{cache:"no-store"});if(!t.ok)throw new Error("Products API not available");const e=await t.json(),i=Array.isArray(e?.items)?e.items:[];if(at(i),!i.length)return r.innerHTML='<div class="price-card"><h3>'+O(L.productsUnavailable)+"</h3></div>",void H();r.innerHTML=i.map((t,e)=>W(t,e)).join(""),H(),st(),ut(),R("auto")}catch(t){H(),st(),ut(),R("auto")}else H()}(),ut(),l&&l.addEventListener("click",t=>{if(t.preventDefault(),t.stopPropagation(),P)return clearTimeout(P),P=null,void(window.location.href=B);P=setTimeout(()=>{if(P=null,!u)return;u.classList.contains("open")?dt():u&&(u.classList.add("open"),u.setAttribute("aria-hidden","false"))},220)}),y&&y.addEventListener("click",t=>{t.preventDefault(),window.location.href=B}),v&&(v.addEventListener("input",()=>{const t=String(v.value||"").trim().toUpperCase();I&&I.value!==t&&(I.value=t)}),v.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),q=String(v.value||"").trim().toUpperCase(),X(q),I&&I.value!==q&&(I.value=q),tt(q))})),I&&(I.addEventListener("input",()=>{const t=String(I.value||"").trim().toUpperCase();v&&v.value!==t&&(v.value=t)}),I.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),q=String(I.value||"").trim().toUpperCase(),X(q),v&&v.value!==q&&(v.value=q),tt(q))})),[C,A].forEach(t=>{t&&(String(t.getAttribute("placeholder")||"").trim()||t.setAttribute("placeholder",L.emailPlaceholder),t.addEventListener("input",()=>{const e=String(t.value||"").trim().toLowerCase();J(e)&&(localStorage.setItem("checkout_email",e),C&&C!==t&&(C.value=e),A&&A!==t&&(A.value=e))}))}),document.addEventListener("click",t=>{u&&l&&(u.contains(t.target)||l.contains(t.target)||dt())}),document.addEventListener("keydown",t=>{"Escape"===t.key&&dt()}),window.addEventListener("gptishka:cart-cleared",()=>{q="",T="idle",M=0,U="",v&&(v.value=""),I&&(I.value=""),ut(),st()}),window.addEventListener("hashchange",()=>{R("smooth")}),window.gptishkaCart={getQty:function(t){const e=String(t||"").trim();return e?z().reduce((t,r)=>r&&r.product===e?t+Math.max(1,N(r.qty)):t,0):0},getCardQty:ot,getCardItem:rt,persistCartSelection:mt}})(),document.addEventListener("click",t=>{const e=t.target.closest&&t.target.closest("a.buy-btn");if(e)try{const t=new URL(e.getAttribute("href"),window.location.href),r=e.getAttribute("data-product")||t.searchParams.get("product")||e.getAttribute("data-plan")||t.searchParams.get("plan"),i={product:r,title:e.getAttribute("data-title")||null,sub:e.getAttribute("data-sub")||null,term:e.getAttribute("data-term")||null,price:e.getAttribute("data-price")||null,currency:e.getAttribute("data-currency")||null,qty:1,total_price:null},n=e.closest&&e.closest(".price-card");if(n){if(!i.title){const t=n.querySelector("h3");t&&(i.title=(t.innerText||"").replace(/\s+/g," ").trim())}if(!i.term){const t=n.querySelector(".term");t&&(i.term=(t.innerText||"").replace(/\s+/g," ").trim())}if(!i.sub){const t=n.querySelector(".sub");t&&(i.sub=(t.innerText||"").replace(/\s+/g," ").trim())}if(!i.price){const t=n.querySelector(".price");t&&(i.price=(t.innerText||"").replace(/[^\d.,-]/g,""))}if(i.currency||(i.currency="RUB"),window.gptishkaCart&&"function"==typeof window.gptishkaCart.getCardQty){const t=window.gptishkaCart.getCardItem(n);if(t&&t.product){const e=window.gptishkaCart.getCardQty(t.product);i.qty=e>0?e:1}}}const a=toAmount(i.price);Number.isFinite(a)&&a>0&&(i.total_price=String(Number((a*i.qty).toFixed(2)))),r&&localStorage.setItem("selected_product",JSON.stringify(i))}catch(t){}},!0),(()=>{const t="gptishka_session_id";let e=null,r=null,i=null,n=!1;function a(t){if(!e)return;const r=Array.isArray(t)?t.filter(Boolean):[],i='<span class="site-ticker__sep">â€¢</span>',n=(r.length?r:["No recent subscriptions yet"]).map(t=>'<span class="site-ticker__item">ðŸ”¥ '+(String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")+" subscribed</span>")).join(i),a=new Array(4).fill(n).join(i);e.innerHTML='<div class="site-ticker__loop">'+a+'</div><div class="site-ticker__loop" aria-hidden="true">'+a+"</div>"}function o(t){const e=Number(t||0);return Number.isFinite(e)?e.toLocaleString():"0"}async function c(){try{const t=await fetch("/api/stats",{cache:"no-store"});if(!t.ok)return;const e=await t.json();r&&(r.textContent=o(e.sales)),i&&(i.textContent=o(e.online)),a(e.lastBuyers)}catch(t){}}async function l(t){try{await fetch("/api/heartbeat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t,path:window.location.pathname}),keepalive:!0})}catch(t){}}function s(){if(n)return;n=!0,function(){if(document.getElementById("siteTicker"))return;const t=document.querySelector("header");if(!t)return;const n=document.createElement("div");n.id="siteTicker",n.className="site-ticker",n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.innerHTML=['<div class="site-ticker__marquee">','  <div class="site-ticker__track" id="siteTickerTrack"></div>',"</div>",'<div class="site-ticker__stats">','  <span class="site-ticker__stat"><span class="site-ticker__stat-label">Sales:</span> <strong id="siteTickerSales">0</strong></span>','  <span class="site-ticker__dot"></span>','  <span class="site-ticker__stat"><span class="site-ticker__stat-label">Online:</span> <strong id="siteTickerOnline">0</strong></span>',"</div>"].join(""),t.insertBefore(n,t.firstChild),e=document.getElementById("siteTickerTrack"),r=document.getElementById("siteTickerSales"),i=document.getElementById("siteTickerOnline")}(),a([]);const o=function(){try{const e=localStorage.getItem(t);if(e)return e;const r="s_"+Date.now().toString(36)+"_"+Math.random().toString(36).slice(2,10);return localStorage.setItem(t,r),r}catch(t){return"s_"+Date.now().toString(36)}}();l(o),c(),window.setInterval(()=>{l(o)},2e4),window.setInterval(()=>{c()},15e3)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()})();;(()=>{const e="gptishka_reviews_cache_v1",t="gptishka_reviews_cache_ts_v1",s=108e5,o="/api/reviews/telegram?limit=20";function a(){try{const s=localStorage.getItem(e),o=Number(localStorage.getItem(t)||0),a=JSON.parse(s||"[]"),r=Array.isArray(a)&&a.length>0;return{isFresh:r&&Date.now()-o<s}}catch(e){return{isFresh:!1}}}function r(s){try{localStorage.setItem(e,JSON.stringify(s)),localStorage.setItem(t,String(Date.now()))}catch(e){}}function i(){if(a().isFresh)return;fetch(o,{headers:{Accept:"application/json"},cache:"no-store"}).then(e=>e.ok?e.json():Promise.reject(new Error("reviews api failed"))).then(e=>{const t=Array.isArray(e?.items)?e.items:[];t.length&&r(t)}).catch(()=>{})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()})();
